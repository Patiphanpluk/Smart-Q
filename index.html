<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Q-Master Queue System</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Custom Styles -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Sarabun', sans-serif;
        }

        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fade-in 0.3s ease-out forwards;
        }
        .animate-bounce-slow {
            animation: bounce 2s infinite;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(-5%); }
            50% { transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- Icons (Lucide React Ports) ---
        const IconBase = ({ children, size = 24, className = "" }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width={size} 
                height={size} 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className}
            >
                {children}
            </svg>
        );

        const User = (props) => <IconBase {...props}><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></IconBase>;
        const Monitor = (props) => <IconBase {...props}><rect width="20" height="14" x="2" y="3" rx="2"/><line x1="8" x2="16" y1="21" y2="21"/><line x1="12" x2="12" y1="17" y2="21"/></IconBase>;
        const Bell = (props) => <IconBase {...props}><path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/><path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/></IconBase>;
        const CheckCircle = (props) => <IconBase {...props}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><path d="M22 4 12 14.01l-3-3"/></IconBase>;
        const Clock = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></IconBase>;
        const Users = (props) => <IconBase {...props}><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></IconBase>;
        const XCircle = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></IconBase>;
        const Volume2 = (props) => <IconBase {...props}><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/></IconBase>;
        const ExternalLink = (props) => <IconBase {...props}><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" x2="21" y1="14" y2="3"/></IconBase>;
        const LogOut = (props) => <IconBase {...props}><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></IconBase>;

        // --- Sub-Components ---

        const Navbar = ({ activeTab, setActiveTab, setIsKioskMode }) => (
            <div className="bg-white shadow-sm border-b border-slate-100 p-4 sticky top-0 z-50">
                <div className="max-w-6xl mx-auto flex justify-between items-center">
                    <div className="flex items-center gap-2">
                        <div className="w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center text-white font-bold shadow-indigo-200 shadow-lg">
                            Q
                        </div>
                        <span className="font-bold text-slate-800 text-lg hidden sm:block">Q-Master</span>
                    </div>
                    
                    <div className="flex gap-2 items-center">
                        <div className="flex gap-1 bg-slate-100 p-1 rounded-xl mr-2">
                            <button 
                                onClick={() => setActiveTab('admin')}
                                className={`px-4 py-2 rounded-lg text-sm font-medium transition-all ${activeTab === 'admin' ? 'bg-white text-indigo-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}
                            >
                                <span className="flex items-center gap-2"><User size={16}/> <span className="hidden sm:inline">เจ้าหน้าที่ (Admin)</span></span>
                            </button>
                            <button 
                                onClick={() => setActiveTab('display')}
                                className={`px-4 py-2 rounded-lg text-sm font-medium transition-all ${activeTab === 'display' ? 'bg-white text-indigo-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}
                            >
                                <span className="flex items-center gap-2"><Monitor size={16}/> <span className="hidden sm:inline">จอแสดงผล</span></span>
                            </button>
                        </div>

                        <button 
                            onClick={() => setIsKioskMode(true)}
                            className="flex items-center gap-2 bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-xl text-sm font-medium shadow-lg shadow-indigo-200 transition-all ml-2"
                        >
                            <ExternalLink size={16}/> 
                            <span>เปิดหน้าลูกค้า (Kiosk)</span>
                        </button>
                    </div>
                </div>
            </div>
        );

        const CustomerView = ({ 
            isKioskMode, 
            setIsKioskMode, 
            myQueue, 
            setMyQueue, 
            customerName, 
            setCustomerName, 
            handleBookQueue, 
            waitingQueues, 
            queues 
        }) => (
            <div className={`min-h-screen bg-slate-50 flex flex-col items-center ${isKioskMode ? 'justify-center p-6' : 'mt-8 p-4'}`}>
                
                {/* Header only for Kiosk Mode */}
                {isKioskMode && (
                    <div className="absolute top-6 left-0 w-full text-center">
                        <div className="inline-flex items-center gap-2 text-slate-400 font-medium">
                            <div className="w-6 h-6 bg-indigo-600 rounded flex items-center justify-center text-white text-xs font-bold">Q</div>
                            <span>ระบบจองคิวอัตโนมัติ</span>
                        </div>
                    </div>
                )}

                <div className="w-full max-w-md">
                    {!myQueue || myQueue.status === 'completed' || myQueue.status === 'cancelled' ? (
                        <div className="bg-white rounded-3xl shadow-xl border border-slate-100 overflow-hidden">
                            <div className="bg-indigo-600 p-8 text-white text-center relative overflow-hidden">
                                <div className="absolute top-0 left-0 w-full h-full bg-white opacity-5 bg-[radial-gradient(#fff_1px,transparent_1px)] [background-size:16px_16px]"></div>
                                <h2 className="text-3xl font-bold mb-2 relative z-10">ยินดีต้อนรับ</h2>
                                <p className="opacity-90 relative z-10">กรุณากรอกชื่อเพื่อรับคิวใช้บริการ</p>
                            </div>
                            <div className="p-8">
                                <form onSubmit={handleBookQueue} className="space-y-6">
                                    <div>
                                        <label className="block text-sm font-medium text-slate-700 mb-2">ชื่อของคุณ</label>
                                        <input
                                            type="text"
                                            value={customerName}
                                            onChange={(e) => setCustomerName(e.target.value)}
                                            className="w-full px-4 py-4 rounded-xl border border-slate-200 bg-slate-50 focus:bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all text-lg"
                                            placeholder="เช่น คุณสมชาย"
                                            required
                                            autoFocus
                                        />
                                    </div>
                                    <button 
                                        type="submit"
                                        className="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 rounded-xl shadow-lg shadow-indigo-200 transition-all transform hover:scale-[1.02] active:scale-95 text-lg"
                                    >
                                        รับบัตรคิว
                                    </button>
                                    
                                    <div className="mt-8 flex items-center justify-center gap-2 text-slate-400 text-sm">
                                        <div className="flex -space-x-2">
                                            {[...Array(Math.min(3, waitingQueues.length))].map((_, i) => (
                                                <div key={i} className="w-8 h-8 rounded-full bg-slate-200 border-2 border-white flex items-center justify-center text-xs">
                                                    <User size={12}/>
                                                </div>
                                            ))}
                                        </div>
                                        <span>รออยู่ {waitingQueues.length} คิว</span>
                                    </div>
                                </form>
                            </div>
                        </div>
                    ) : (
                        <div className="bg-white rounded-3xl shadow-xl border border-slate-100 overflow-hidden relative">
                            <div className="absolute top-0 left-0 w-full h-3 bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500"></div>
                            <div className="p-8 text-center space-y-8">
                                <div>
                                    <p className="text-slate-500 mb-2 uppercase tracking-wider text-xs font-bold">หมายเลขคิวของคุณ</p>
                                    <h1 className="text-7xl font-black text-slate-800 tracking-tighter">{myQueue.number}</h1>
                                </div>
                                
                                <div className={`inline-flex items-center gap-2 px-6 py-3 rounded-full text-base font-medium
                                    ${myQueue.status === 'waiting' ? 'bg-yellow-50 text-yellow-700 border border-yellow-100' : ''}
                                    ${myQueue.status === 'serving' ? 'bg-green-50 text-green-700 border border-green-100 animate-pulse' : ''}
                                `}>
                                    {myQueue.status === 'waiting' && <><Clock size={20}/> กำลังรอเรียก...</>}
                                    {myQueue.status === 'serving' && <><Volume2 size={20}/> ถึงคิวคุณแล้ว!</>}
                                </div>

                                <div className="bg-slate-50 rounded-2xl p-6 flex justify-between items-center text-sm border border-slate-100">
                                    <div className="text-left">
                                        <p className="text-slate-400 text-xs mb-1">ชื่อผู้จอง</p>
                                        <p className="font-semibold text-slate-700 text-lg">{myQueue.name}</p>
                                    </div>
                                    <div className="text-right">
                                        <p className="text-slate-400 text-xs mb-1">คิวที่ต้องรอ</p>
                                        <p className="font-semibold text-indigo-600 text-lg">{
                                            queues.filter(q => q.id < myQueue.id && q.status === 'waiting').length
                                        } คิว</p>
                                    </div>
                                </div>

                                {myQueue.status === 'serving' && (
                                    <div className="bg-green-50 border border-green-200 rounded-2xl p-6 text-green-800 animate-bounce-slow">
                                        <p className="font-bold text-lg">เชิญที่ช่องบริการ 1</p>
                                        <p className="text-sm opacity-80 mt-1">กรุณาแสดงหน้าจอนี้กับเจ้าหน้าที่</p>
                                    </div>
                                )}

                                <button 
                                    onClick={() => setMyQueue(null)}
                                    className="text-slate-400 text-sm hover:text-slate-600 underline py-2"
                                >
                                    จองคิวใหม่ (ยกเลิกคิวเดิม)
                                </button>
                            </div>
                        </div>
                    )}
                </div>

                {/* Exit Button */}
                {isKioskMode && (
                    <button 
                        onClick={() => setIsKioskMode(false)}
                        className="fixed bottom-4 right-4 text-slate-300 hover:text-slate-500 transition-colors p-2"
                        title="Exit Kiosk Mode"
                    >
                        <LogOut size={20} />
                    </button>
                )}
            </div>
        );

        const DisplayBoard = ({ currentServing, waitingQueues }) => (
            <div className="h-[calc(100vh-80px)] p-4 flex flex-col md:flex-row gap-4 max-w-7xl mx-auto">
                <div className="flex-1 bg-gradient-to-br from-indigo-600 to-violet-700 rounded-3xl shadow-2xl flex flex-col items-center justify-center text-white p-8 relative overflow-hidden">
                    <div className="absolute top-0 right-0 p-32 bg-white opacity-5 rounded-full blur-3xl transform translate-x-1/2 -translate-y-1/2"></div>
                    <div className="absolute bottom-0 left-0 p-24 bg-black opacity-10 rounded-full blur-2xl transform -translate-x-1/2 translate-y-1/2"></div>
                    
                    <h2 className="text-2xl md:text-3xl font-medium opacity-90 mb-4">หมายเลขที่กำลังเรียก</h2>
                    
                    {currentServing ? (
                        <div className="text-center animate-bounce-slow">
                            <h1 className="text-8xl md:text-[12rem] font-black tracking-tighter leading-none mb-4">
                                {currentServing.number}
                            </h1>
                            <div className="bg-white/20 backdrop-blur-sm rounded-full px-8 py-3 inline-block">
                                <p className="text-xl md:text-3xl font-bold">คุณ{currentServing.name}</p>
                            </div>
                            <p className="mt-8 text-xl md:text-2xl font-medium text-indigo-200 animate-pulse">เชิญที่ช่องบริการ 1</p>
                        </div>
                    ) : (
                        <div className="text-center opacity-50">
                            <h1 className="text-8xl font-black">---</h1>
                            <p className="text-2xl mt-4">ยังไม่มีการเรียกคิว</p>
                        </div>
                    )}
                </div>

                <div className="w-full md:w-96 bg-white rounded-3xl shadow-xl border border-slate-100 flex flex-col overflow-hidden">
                    <div className="bg-slate-50 p-6 border-b border-slate-100">
                        <h3 className="font-bold text-slate-700 text-lg flex items-center gap-2">
                            <Clock size={20} className="text-indigo-500"/> คิวถัดไป ({waitingQueues.length})
                        </h3>
                    </div>
                    <div className="flex-1 overflow-y-auto p-4 space-y-3">
                        {waitingQueues.length > 0 ? (
                            waitingQueues.slice(0, 6).map((q, idx) => (
                                <div key={q.id} className="flex items-center justify-between p-4 bg-white border border-slate-100 rounded-xl shadow-sm">
                                    <div className="flex items-center gap-4">
                                        <div className="bg-slate-100 text-slate-600 font-bold w-12 h-12 rounded-lg flex items-center justify-center text-xl">
                                            {q.number}
                                        </div>
                                        <div>
                                            <p className="font-medium text-slate-800">คุณ{q.name}</p>
                                            <p className="text-xs text-slate-400">รอประมาณ {idx * 5} นาที</p>
                                        </div>
                                    </div>
                                </div>
                            ))
                        ) : (
                            <div className="text-center py-12 text-slate-400">
                                <p>ไม่มีคิวรอ</p>
                            </div>
                        )}
                    </div>
                </div>
            </div>
        );

        const AdminView = ({ currentServing, waitingQueues, queues, handleCallQueue, handleCompleteQueue, handleCancelQueue }) => (
            <div className="max-w-6xl mx-auto p-6">
                <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    
                    <div className="lg:col-span-2 space-y-6">
                        <div className="bg-white rounded-2xl shadow-sm border border-slate-200 p-6">
                            <h2 className="text-lg font-bold text-slate-800 mb-4 flex items-center gap-2">
                                <Monitor size={20} className="text-indigo-600"/> กำลังให้บริการ
                            </h2>
                            
                            {currentServing ? (
                                <div className="flex flex-col sm:flex-row items-center justify-between gap-6 bg-indigo-50 rounded-xl p-6 border border-indigo-100">
                                    <div className="text-center sm:text-left">
                                        <span className="text-sm font-semibold text-indigo-500 uppercase tracking-wide">Current Queue</span>
                                        <div className="text-5xl font-black text-slate-800 my-1">{currentServing.number}</div>
                                        <div className="text-lg text-slate-600">คุณ{currentServing.name}</div>
                                    </div>
                                    
                                    <div className="flex gap-3 w-full sm:w-auto">
                                        <button 
                                            onClick={() => handleCompleteQueue(currentServing.id)}
                                            className="flex-1 sm:flex-none flex items-center justify-center gap-2 bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-xl font-bold transition-all shadow-lg shadow-green-200"
                                        >
                                            <CheckCircle size={20}/> เสร็จสิ้น
                                        </button>
                                        <button 
                                            onClick={() => handleCancelQueue(currentServing.id)}
                                            className="flex-1 sm:flex-none flex items-center justify-center gap-2 bg-white border border-red-200 text-red-500 hover:bg-red-50 px-6 py-3 rounded-xl font-bold transition-all"
                                        >
                                            <XCircle size={20}/> ยกเลิก
                                        </button>
                                    </div>
                                </div>
                            ) : (
                                <div className="bg-slate-50 rounded-xl p-8 text-center text-slate-400 border border-dashed border-slate-200">
                                    <p>ยังไม่มีการเรียกคิว</p>
                                </div>
                            )}
                        </div>

                        <div className="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                            <div className="p-6 border-b border-slate-100 flex justify-between items-center">
                                <h2 className="text-lg font-bold text-slate-800 flex items-center gap-2">
                                    <Users size={20} className="text-indigo-600"/> รายการคิวรอ ({waitingQueues.length})
                                </h2>
                            </div>
                            <div className="divide-y divide-slate-100">
                                {waitingQueues.length > 0 ? (
                                    waitingQueues.map((q) => (
                                        <div key={q.id} className="p-4 flex items-center justify-between hover:bg-slate-50 transition-colors">
                                            <div className="flex items-center gap-4">
                                                <div className="text-xl font-bold text-slate-700 w-16">{q.number}</div>
                                                <div>
                                                    <div className="font-medium text-slate-900">คุณ{q.name}</div>
                                                    <div className="text-xs text-slate-400">{q.timestamp}</div>
                                                </div>
                                            </div>
                                            <button
                                                onClick={() => handleCallQueue(q)}
                                                disabled={!!currentServing}
                                                className={`flex items-center gap-2 px-4 py-2 rounded-lg font-medium text-sm transition-all
                                                    ${currentServing 
                                                        ? 'bg-slate-100 text-slate-400 cursor-not-allowed' 
                                                        : 'bg-indigo-600 text-white hover:bg-indigo-700 shadow-md shadow-indigo-100'}`}
                                            >
                                                <Bell size={16}/> เรียกคิว
                                            </button>
                                        </div>
                                    ))
                                ) : (
                                    <div className="p-8 text-center text-slate-400">ไม่มีคิวรอเรียก</div>
                                )}
                            </div>
                        </div>
                    </div>

                    <div className="space-y-6">
                        <div className="bg-white rounded-2xl shadow-sm border border-slate-200 p-6">
                            <h3 className="text-sm font-semibold text-slate-400 uppercase mb-4">สรุปวันนี้</h3>
                            <div className="space-y-4">
                                <div className="flex items-center justify-between p-4 bg-slate-50 rounded-xl">
                                    <span className="text-slate-600">คิวทั้งหมด</span>
                                    <span className="text-2xl font-bold text-slate-800">{queues.length}</span>
                                </div>
                                <div className="flex items-center justify-between p-4 bg-green-50 rounded-xl text-green-700">
                                    <span className="font-medium">เสร็จสิ้น</span>
                                    <span className="text-2xl font-bold">{queues.filter(q => q.status === 'completed').length}</span>
                                </div>
                                <div className="flex items-center justify-between p-4 bg-red-50 rounded-xl text-red-700">
                                    <span className="font-medium">ยกเลิก/ข้าม</span>
                                    <span className="text-2xl font-bold">{queues.filter(q => q.status === 'cancelled').length}</span>
                                </div>
                            </div>
                        </div>
                        
                        <div className="bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl shadow-lg p-6 text-white">
                            <h3 className="font-bold mb-2">คำแนะนำ</h3>
                            <ul className="text-sm text-slate-300 space-y-2 list-disc list-inside">
                                <li>กด "เรียกคิว" เมื่อช่องบริการว่าง</li>
                                <li>เมื่อให้บริการเสร็จสิ้น กด "เสร็จสิ้น" เพื่อรับคิวถัดไป</li>
                                <li>หากลูกค้าไม่มาแสดงตัว ให้กด "ยกเลิก"</li>
                            </ul>
                        </div>
                    </div>

                </div>
            </div>
        );

        // --- Main Component ---

        function QueueSystem() {
            const [activeTab, setActiveTab] = useState('admin'); 
            const [isKioskMode, setIsKioskMode] = useState(false); 
            const [queues, setQueues] = useState([]);
            const [lastQueueNumber, setLastQueueNumber] = useState(0);
            const [currentServing, setCurrentServing] = useState(null);
            
            const [customerName, setCustomerName] = useState('');
            const [myQueue, setMyQueue] = useState(null);

            const playSound = () => {
                console.log("Ding Dong! Queue Called");
            };

            const handleBookQueue = (e) => {
                e.preventDefault();
                if (!customerName.trim()) return;

                const newNumber = lastQueueNumber + 1;
                const queueNumber = `A-${String(newNumber).padStart(3, '0')}`;
                
                const newQueue = {
                    id: Date.now(),
                    number: queueNumber,
                    name: customerName,
                    status: 'waiting', 
                    timestamp: new Date().toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit' })
                };

                setQueues([...queues, newQueue]);
                setLastQueueNumber(newNumber);
                setMyQueue(newQueue);
                setCustomerName('');
            };

            const handleCallQueue = (queue) => {
                const updatedQueues = queues.map(q => 
                    q.id === queue.id ? { ...q, status: 'serving' } : q
                );
                setQueues(updatedQueues);
                setCurrentServing(queue);
                playSound();
            };

            const handleCompleteQueue = (id) => {
                const updatedQueues = queues.map(q => 
                    q.id === id ? { ...q, status: 'completed' } : q
                );
                setQueues(updatedQueues);
                setCurrentServing(null);
            };

            const handleCancelQueue = (id) => {
                const updatedQueues = queues.map(q => 
                    q.id === id ? { ...q, status: 'cancelled' } : q
                );
                setQueues(updatedQueues);
                if (currentServing && currentServing.id === id) {
                    setCurrentServing(null);
                }
            };

            const waitingQueues = queues.filter(q => q.status === 'waiting');

            if (isKioskMode) {
                return (
                    <CustomerView 
                        isKioskMode={isKioskMode}
                        setIsKioskMode={setIsKioskMode}
                        myQueue={myQueue}
                        setMyQueue={setMyQueue}
                        customerName={customerName}
                        setCustomerName={setCustomerName}
                        handleBookQueue={handleBookQueue}
                        waitingQueues={waitingQueues}
                        queues={queues}
                    />
                );
            }

            return (
                <div className="min-h-screen bg-slate-50 font-sans text-slate-900 pb-12">
                    <Navbar 
                        activeTab={activeTab} 
                        setActiveTab={setActiveTab} 
                        setIsKioskMode={setIsKioskMode} 
                    />
                    
                    <main className="animate-fade-in">
                        {activeTab === 'admin' && (
                            <AdminView 
                                currentServing={currentServing}
                                waitingQueues={waitingQueues}
                                queues={queues}
                                handleCallQueue={handleCallQueue}
                                handleCompleteQueue={handleCompleteQueue}
                                handleCancelQueue={handleCancelQueue}
                            />
                        )}
                        {activeTab === 'display' && (
                            <DisplayBoard 
                                currentServing={currentServing}
                                waitingQueues={waitingQueues}
                            />
                        )}
                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<QueueSystem />);
    </script>
</body>
</html>
